<!--

    Copyright Â© 2021 ThingsBoard, Inc.

-->
<form [formGroup]="schedulerEventFormGroup" (ngSubmit)="save()">
  <mat-toolbar fxLayout="row" color="primary">
    <h2 translate>{{ isAdd ? 'scheduler.create' : (readonly ? 'scheduler.view' : 'scheduler.edit')}}</h2>
    <span fxFlex></span>
    <button mat-button mat-icon-button
            (click)="cancel()"
            type="button">
      <mat-icon class="material-icons">close</mat-icon>
    </button>
  </mat-toolbar>
  <mat-progress-bar color="warn" mode="indeterminate" *ngIf="isLoading$ | async">
  </mat-progress-bar>
  <div style="height: 4px;" *ngIf="!(isLoading$ | async)"></div>
  <div mat-dialog-content>
    <fieldset [disabled]="isLoading$ | async">
      <mat-tab-group dynamicHeight>
        <mat-tab label="{{ 'scheduler.configuration' | translate }}">
          <div fxLayout="column" class="mat-padding">
            <tb-scheduler-event-type-autocomplete
              formControlName="type"
              required
              [schedulerEventConfigTypes]="schedulerEventConfigTypes"
            ></tb-scheduler-event-type-autocomplete>
            <tb-scheduler-event-config
              [fxShow]="schedulerEventFormGroup.get('type').value"
              formControlName="configuration"
              [schedulerEventConfigTypes]="schedulerEventConfigTypes"
              [schedulerEventType]="schedulerEventFormGroup.get('type').value">
            </tb-scheduler-event-config>
            <div [fxShow]="!schedulerEventFormGroup.get('type').value" style="height: 30px;"></div>
          </div>
        </mat-tab>
        <mat-tab label="{{ 'scheduler.schedule' | translate }}">
          <div fxLayout="column" class="mat-padding">
            <tb-scheduler-event-schedule
              formControlName="schedule">
            </tb-scheduler-event-schedule>
          </div>
        </mat-tab>
      </mat-tab-group>
    </fieldset>
  </div>
  <div mat-dialog-actions fxLayout="row">
    <span fxFlex></span>
    <button mat-button color="primary"
            type="button"
            [disabled]="(isLoading$ | async)"
            (click)="cancel()" cdkFocusInitial>
      {{ (readonly  ? 'action.close' : 'action.cancel') | translate }}
    </button>
    <button *ngIf="!readonly" mat-button mat-raised-button color="primary"
            type="submit"
            [disabled]="(isLoading$ | async) || schedulerEventFormGroup.invalid || !schedulerEventFormGroup.dirty">
      {{ (isAdd  ? 'action.create' : 'action.save') | translate }}
    </button>
  </div>
</form>
